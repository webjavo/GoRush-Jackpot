<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
.tabs{display:flex;background:#111}
.tabs button{flex:1;padding:14px;border:none;background:#111;color:#fff;font-weight:bold}
.tabs button.active{background:#2ea043}
.section{display:none;padding:15px}
.section.active{display:block}
input,select{width:100%;padding:10px;margin:6px 0;background:#222;border:none;border-radius:6px;color:#fff}
button.action{padding:10px;border:none;border-radius:6px;margin:4px 0;font-weight:bold}
.green{background:#2ea043}
.red{background:#f44336}
.orange{background:#ff9800;color:#000}
.list{margin-top:10px;font-size:14px}
.card{background:#111;padding:10px;border-radius:6px;margin-bottom:6px}
</style>
</head>

<body>

<div class="tabs">
  <button class="active" onclick="openTab('users')">Users</button>
  <button onclick="openTab('withdrawals')">Withdrawals</button>
  <button onclick="openTab('logs')">Audit Logs</button>
  <button onclick="openTab('countdown')">Countdown</button>
</div>

<!-- USERS -->
<div id="users" class="section active">
  <h3>Users</h3>
  <input id="searchPhone" placeholder="Search phone number">
  <button class="action green" onclick="searchUser()">Search</button>

  <div id="userResult"></div>
</div>

<!-- WITHDRAWALS -->
<div id="withdrawals" class="section">
  <h3>Withdrawals</h3>
  <div id="withdrawList"></div>
</div>

<!-- AUDIT LOGS -->
<div id="logs" class="section">
  <h3>Audit Logs</h3>
  <button class="action red" onclick="clearLogs()">Clear Logs</button>
  <div id="logList"></div>
</div>

<!-- COUNTDOWN -->
<div id="countdown" class="section">
  <h3>Global Countdown</h3>

  <input id="days" type="number" placeholder="Days">
  <input id="hours" type="number" placeholder="Hours">
  <input id="minutes" type="number" placeholder="Minutes">
  <input id="seconds" type="number" placeholder="Seconds">

  <button class="action green" onclick="startCountdown()">Start</button>
  <button class="action red" onclick="resetCountdown()">Reset</button>

  <p id="countdownStatus" style="color:yellow;margin-top:10px"></p>
</div>

<script>
function openTab(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');

  if(id==='withdrawals') loadWithdrawals();
  if(id==='logs') loadLogs();
  if(id==='countdown') showCountdownStatus();
}

/* ---------- USERS ---------- */
function searchUser(){
  const phone = document.getElementById('searchPhone').value.trim();
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  const box = document.getElementById('userResult');
  box.innerHTML = '';

  if(!users[phone]){
    box.innerHTML = '<p>User not found</p>';
    return;
  }

  const u = users[phone];
  box.innerHTML = `
    <div class="card">
      <p><b>${phone}</b></p>
      <p>Balance: ₦${(u.balance||0).toLocaleString()}</p>
      <p>Status: ${u.status}</p>

      <input id="fundAmount" type="number" placeholder="Fund amount">
      <button class="action green" onclick="fundUser('${phone}')">Fund</button>

      <button class="action orange" onclick="toggleUser('${phone}')">
        ${u.status==='active'?'Disable':'Enable'}
      </button>

      <button class="action red" onclick="clearUser('${phone}')">Clear User</button>
    </div>
  `;
}

function fundUser(phone){
  const amt = Number(document.getElementById('fundAmount').value);
  if(amt<=0) return alert('Invalid amount');

  const users = JSON.parse(localStorage.getItem('users'));
  users[phone].balance = (users[phone].balance||0) + amt;
  localStorage.setItem('users', JSON.stringify(users));

  logAction(`Funded ${phone} with ₦${amt}`);
  alert('User funded');
  searchUser();
}

function toggleUser(phone){
  const users = JSON.parse(localStorage.getItem('users'));
  users[phone].status = users[phone].status==='active'?'disabled':'active';
  localStorage.setItem('users', JSON.stringify(users));
  logAction(`User ${phone} status changed`);
  searchUser();
}

function clearUser(phone){
  const users = JSON.parse(localStorage.getItem('users'));
  delete users[phone];
  localStorage.setItem('users', JSON.stringify(users));
  logAction(`User ${phone} cleared`);
  document.getElementById('userResult').innerHTML='';
}

/* ---------- WITHDRAWALS ---------- */
function loadWithdrawals(){
  const w = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  const box = document.getElementById('withdrawList');
  box.innerHTML = w.length?'' : '<p>No withdrawals</p>';

  w.forEach(x=>{
    box.innerHTML += `
      <div class="card">
        <p>${x.phone}</p>
        <p>₦${x.amount}</p>
        <p>${x.bankName}</p>
        <p>Status: ${x.status}</p>
      </div>
    `;
  });
}

/* ---------- AUDIT LOGS ---------- */
function logAction(action){
  const logs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
  logs.push({time:new Date().toLocaleString(),action});
  localStorage.setItem('auditLogs', JSON.stringify(logs));
}

function loadLogs(){
  const logs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
  const box = document.getElementById('logList');
  box.innerHTML = logs.length?'' : '<p>No logs</p>';

  logs.forEach(l=>{
    box.innerHTML += `<div class="card">${l.time} — ${l.action}</div>`;
  });
}

function clearLogs(){
  localStorage.removeItem('auditLogs');
  loadLogs();
}

/* ---------- COUNTDOWN ---------- */
function startCountdown(){
  const d = +days.value||0, h=+hours.value||0, m=+minutes.value||0, s=+seconds.value||0;
  const total = (((d*24+h)*60+m)*60+s);
  if(total<=0) return alert('Invalid time');

  const endTime = Date.now() + total*1000;
  localStorage.setItem('globalCountdown', JSON.stringify({endTime,running:true}));
  logAction('Countdown started');
  showCountdownStatus();
}

function resetCountdown(){
  localStorage.setItem('globalCountdown', JSON.stringify({endTime:0,running:false}));
  logAction('Countdown reset');
  showCountdownStatus();
}

function showCountdownStatus(){
  const data = JSON.parse(localStorage.getItem('globalCountdown') || '{}');
  const el = document.getElementById('countdownStatus');
  if(!data.running || !data.endTime){
    el.innerText = 'Countdown stopped';
    return;
  }
  const diff = Math.max(0, Math.floor((data.endTime-Date.now())/1000));
  el.innerText = diff>0 ? 'Countdown running' : 'Countdown ended';
}
</script>

</body>
</html>
