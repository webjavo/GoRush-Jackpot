<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Withdraw</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#000;color:#fff;font-family:Arial;margin:0}
.box{max-width:380px;margin:50px auto;background:#111;padding:20px;border-radius:10px}
input{width:100%;padding:12px;margin:6px 0;background:#222;border:none;border-radius:6px;color:#fff}
button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:6px;font-weight:bold}
.withdraw{background:#ff9800;color:#000}
.cancel{background:#f44336;color:#fff}
.msg{margin-top:10px;color:red;text-align:center}
</style>
</head>

<body>

<div class="box">
  <h3 style="color:yellow">Withdraw Funds</h3>

  <input id="amount" type="number" placeholder="Enter amount">
  <input id="accountName" placeholder="Account Name">
  <input id="accountNumber" placeholder="Account Number">
  <input id="bankName" placeholder="Bank Name">

  <button class="withdraw" onclick="processWithdraw()">Withdraw</button>
  <button class="cancel" onclick="goBack()">Cancel</button>

  <div class="msg" id="msg"></div>
</div>

<script>
function goBack(){
  window.location.href = 'dashboard.html';
}

function processWithdraw(){
  const amount = Number(document.getElementById('amount').value);
  const accountName = document.getElementById('accountName').value.trim();
  const accountNumber = document.getElementById('accountNumber').value.trim();
  const bankName = document.getElementById('bankName').value.trim();
  const msg = document.getElementById('msg');

  msg.innerText = '';

  if(!amount || amount <= 0){
    msg.innerText = 'Enter a valid amount';
    return;
  }
  if(!accountName || !accountNumber || !bankName){
    msg.innerText = 'All bank details are required';
    return;
  }

  const phone = localStorage.getItem('currentUser');
  if(!phone){
    msg.innerText = 'User not logged in';
    return;
  }

  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if(!users[phone]){
    msg.innerText = 'User record not found';
    return;
  }

  const balance = Number(users[phone].balance || 0);

  // ðŸ”´ INSUFFICIENT FUNDS CHECK
  if(balance < amount){
    msg.innerText = 'Insufficient funds';
    return;
  }

  // âœ… Deduct balance
  users[phone].balance = balance - amount;
  localStorage.setItem('users', JSON.stringify(users));

  // âœ… Log withdrawal for admin
  const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
  withdrawals.push({
    phone,
    amount,
    bankName,
    accountNumber,
    accountName,
    time: new Date().toISOString(),
    status: 'pending'
  });
  localStorage.setItem('withdrawals', JSON.stringify(withdrawals));

  alert('Withdrawal request submitted successfully');
  window.location.href = 'dashboard.html';
}
</script>

</body>
</html>
