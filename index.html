<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login to GoalRush Jackpot</title>
<style>
  :root{
    --bg1:#0f2027; --bg2:#203a43; --accent:#ffd700; --danger:#ff6b6b; --ok:#6ee7b7;
  }
  body{
    margin:0; min-height:100vh; font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center; padding:20px; color:#fff;
  }
  .card{
    width:380px; border-radius:12px; padding:18px; background: rgba(255,255,255,0.03);
    backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  }
  h1{margin:0 0 12px 0; color:var(--accent); text-align:center}
  .tabs{display:flex; gap:8px; margin-bottom:12px}
  .tabs button{flex:1;padding:9px;border-radius:8px;border:0;background:rgba(255,255,255,0.03);color:#fff;font-weight:700;cursor:pointer}
  .tabs button.active{background:var(--accent); color:#000}
  label{display:block;margin:8px 0 6px;font-weight:700}
  input[type="text"], input[type="password"], input[type="tel"]{
    width:100%; padding:10px; border-radius:8px; border:0; background:rgba(255,255,255,0.04); color:#fff; margin-bottom:8px;
  }
  .password-wrapper{ position:relative }
  .toggle-password{ position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; user-select:none }
  .btn{ width:100%; padding:11px; border-radius:10px; border:0; font-weight:800; cursor:pointer; background:linear-gradient(180deg,var(--accent),#e5b400); color:#000; }
  .message{ min-height:18px; margin-top:8px; font-size:13px; text-align:center }
  .msg-danger{ color:var(--danger); }
  .msg-ok{ color:var(--ok); }
  a.link{ color:var(--accent); cursor:pointer; font-size:13px; display:block; margin-top:6px; text-align:right; }

  /* popup modal */
  .backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:60 }
  .modal{ width:92%; max-width:420px; background:#071026; border-radius:12px; padding:18px; border:1px solid rgba(255,255,255,0.04); box-shadow:0 10px 40px rgba(0,0,0,0.6); color:#fff; text-align:center }
  .modal h3{ margin:0 0 8px; color:#8ef08e }
  .modal p{ color:rgba(255,255,255,0.8); margin-bottom:14px }
  .modal .ok{ padding:10px 18px; border-radius:8px; border:0; background:linear-gradient(180deg,#ffd700,#e5b400); font-weight:800; cursor:pointer; }
  @media(max-width:420px){ .card{ width:100% } }

  /* invisible admin button */
  #secretBtn {
    position: fixed;
    bottom: 10px;
    left: 10px;
    width: 50px;
    height: 50px;
    opacity: 0;
    cursor: pointer;
    z-index: 9999;
  }
</style>
</head>
<body>

  <div class="card">
    <h1>Login to GoalRush Jackpot</h1>

    <div class="tabs">
      <button id="tabLogin" class="active" onclick="showForm('login')">Login</button>
      <button id="tabSignup" onclick="showForm('signup')">Sign Up</button>
    </div>

    <!-- LOGIN -->
    <div id="formLogin" style="display:block">
      <label for="loginPhone">Phone Number</label>
      <input id="loginPhone" type="tel" placeholder="+2348012345678" autocomplete="tel">

      <label for="loginPassword">Password</label>
      <div class="password-wrapper">
        <input id="loginPassword" type="password" placeholder="Password" autocomplete="current-password">
        <span class="toggle-password" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</span>
      </div>

      <button class="btn" onclick="login()">Login</button>
      <a class="link" onclick="openForgot()">Forgot Password?</a>
      <div id="loginMsg" class="message"></div>
    </div>

    <!-- SIGNUP -->
    <div id="formSignup" style="display:none">
      <label for="signupName">Your Name</label>
      <input id="signupName" type="text" placeholder="Full name" autocomplete="name">

      <label for="signupUsername">Username</label>
      <input id="signupUsername" type="text" placeholder="Username (optional)">

      <label for="signupPhone">Phone Number</label>
      <input id="signupPhone" type="tel" placeholder="+2348012345678" autocomplete="tel">

      <label for="signupPassword">Password</label>
      <div class="password-wrapper">
        <input id="signupPassword" type="password" placeholder="Create password" autocomplete="new-password">
        <span class="toggle-password" onclick="togglePassword('signupPassword', this)">üëÅÔ∏è</span>
      </div>

      <button class="btn" onclick="signup()">Sign Up</button>
      <div id="signupMsg" class="message"></div>
    </div>
  </div>

  <!-- Popup for signup success -->
  <div id="popup" class="backdrop">
    <div class="modal">
      <h3>‚úÖ Account created successfully!</h3>
      <p>Press OK to go to Login.</p>
      <button class="ok" onclick="onPopupOk()">OK</button>
    </div>
  </div>

  <!-- Popup for forgot password -->
  <div id="forgotPopup" class="backdrop">
    <div class="modal">
      <h3>üîë Reset Password</h3>
      <p>Enter your registered phone number and either your username or last 3 characters of your old password.</p>
      <input id="fpPhone" type="tel" placeholder="+2348012345678"><br>
      <input id="fpHint" type="text" placeholder="Username OR last 3 chars of old password"><br>
      <input id="fpNewPass" type="password" placeholder="New password"><br>
      <div id="fpMsg" class="message"></div>
      <button class="ok" onclick="resetPassword()">Change Password</button>
      <button class="ok" style="background:#888;margin-top:8px" onclick="closeForgot()">Cancel</button>
    </div>
  </div>

  <!-- Invisible secret button -->
  <div id="secretBtn"></div>

<script>
function getUsers(){ try{return JSON.parse(localStorage.getItem('users')||'{}')}catch(e){return{}} }
function saveUsers(u){ localStorage.setItem('users', JSON.stringify(u)); }

async function hashPassword(pw){
  if(!crypto.subtle){return pw;}
  const enc=new TextEncoder(); const data=enc.encode(pw);
  const buf=await crypto.subtle.digest('SHA-256',data);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

function showForm(which){
  document.getElementById('formLogin').style.display= which==='login'?'block':'none';
  document.getElementById('formSignup').style.display= which==='signup'?'block':'none';
  document.getElementById('tabLogin').classList.toggle('active',which==='login');
  document.getElementById('tabSignup').classList.toggle('active',which==='signup');
  document.getElementById('loginMsg').textContent='';
  document.getElementById('signupMsg').textContent='';
}

const phonePattern=/^\+\d{7,15}$/; 
const passPattern=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[^\w\s]).{6,}$/;

async function signup(){
  const name=document.getElementById('signupName').value.trim();
  const username=document.getElementById('signupUsername').value.trim();
  const phone=document.getElementById('signupPhone').value.trim();
  const password=document.getElementById('signupPassword').value;
  const msg=document.getElementById('signupMsg'); msg.textContent='';

  if(!name||!phone||!password){msg.textContent='All fields required';msg.className='message msg-danger';return;}
  if(!phonePattern.test(phone)){msg.textContent='Invalid phone format';msg.className='message msg-danger';return;}
  if(!passPattern.test(password)){msg.textContent='Password too weak';msg.className='message msg-danger';return;}

  const users=getUsers(); if(users[phone]){msg.textContent='Phone already registered';msg.className='message msg-danger';return;}

  const hash=await hashPassword(password);
  users[phone]={name,username:username||null,phone,passwordHash:hash,last3:password.slice(-3)};
  saveUsers(users);
  document.getElementById('popup').style.display='flex';
}

function onPopupOk(){ document.getElementById('popup').style.display='none'; showForm('login'); }

async function login(){
  const phone=document.getElementById('loginPhone').value.trim();
  const pw=document.getElementById('loginPassword').value;
  const msg=document.getElementById('loginMsg'); msg.textContent='';
  if(!phone||!pw){msg.textContent='Phone and password required';msg.className='message msg-danger';return;}
  const users=getUsers(); const u=users[phone]; if(!u){msg.textContent='No account found';msg.className='message msg-danger';return;}
  const hash=await hashPassword(pw);
  if(hash===u.passwordHash){window.location.href='dashboard.html';}
  else{msg.textContent='Invalid phone or password';msg.className='message msg-danger';}
}

function togglePassword(id,el){ const f=document.getElementById(id); f.type=f.type==='password'?'text':'password'; el.textContent=f.type==='password'?'üëÅÔ∏è':'üôà'; }

/* Forgot password */
function openForgot(){ document.getElementById('forgotPopup').style.display='flex'; }
function closeForgot(){ document.getElementById('forgotPopup').style.display='none'; }

async function resetPassword(){
  const phone=document.getElementById('fpPhone').value.trim();
  const hint=document.getElementById('fpHint').value.trim();
  const newPass=document.getElementById('fpNewPass').value;
  const msg=document.getElementById('fpMsg'); msg.textContent='';

  const users=getUsers(); const u=users[phone];
  if(!u){msg.textContent='No account found';msg.className='message msg-danger';return;}

  let ok=false;
  if(u.username && hint.toLowerCase()===u.username.toLowerCase()){ok=true;}
  if(!ok && u.last3 && hint===u.last3){ok=true;}

  if(!ok){msg.textContent='Hint does not match username or old password ending';msg.className='message msg-danger';return;}
  if(!passPattern.test(newPass)){msg.textContent='New password too weak';msg.className='message msg-danger';return;}

  const newHash=await hashPassword(newPass);
  u.passwordHash=newHash; u.last3=newPass.slice(-3);
  users[phone]=u; saveUsers(users);
  msg.textContent='Password changed successfully. Please login.'; msg.className='message msg-ok';
  setTimeout(()=>{closeForgot();},1500);
}

if(!localStorage.getItem('users')){saveUsers({});}

/* Secret button logic */
let secretClicks = 0;
document.getElementById("secretBtn").addEventListener("click", () => {
  secretClicks++;
  if(secretClicks >= 15){
    window.location.href = "admin.html";
    secretClicks = 0;
  }
});
</script>
</body>
</html>
